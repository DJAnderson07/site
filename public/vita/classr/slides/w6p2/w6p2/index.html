<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
  <title>Review - Data Science in Education</title>
  <meta name="renderer" content="webkit" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>

<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />

<meta name="theme-color" content="#f8f5ec" />
<meta name="msapplication-navbutton-color" content="#f8f5ec">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="#f8f5ec">


<meta name="author" content="Daniel Anderson" />
  <meta name="description" content="em { font-style: italic }   strong { font-weight: bold; }  Agenda  Review where we&amp;rsquo;ve been  reading in data dplyr tidyr  Where to next? (briefly) Lab  Work on your final project   Tidyverse: Providing a grammar for&amp;hellip;  Graphics (ggplot) Data manipulations (dplyr) Tidying data (tidyr) Ever expanding specialized topics (not quite modeling yet, although there is some)  Reading in data rio makes it easy  Remember there are a bunch of different options you can specify" />

  <meta name="keywords" content="Data Science, Education, Data Visualization" />






<meta name="generator" content="Hugo 0.36.1" />


<link rel="canonical" href="/vita/classr/slides/w6p2/w6p2/" />

<link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
<link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
<link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
<link rel="manifest" href="/manifest.json">
<link rel="mask-icon" href="/safari-pinned-tab.svg" color="#5bbad5">







<link href="/dist/even.min.css?v=3.0.1" rel="stylesheet">
<link href="/lib/fancybox/jquery.fancybox-3.1.20.min.css" rel="stylesheet">




<meta property="og:title" content="Review" />
<meta property="og:description" content="em { font-style: italic }   strong { font-weight: bold; }  Agenda  Review where we&rsquo;ve been  reading in data dplyr tidyr  Where to next? (briefly) Lab  Work on your final project   Tidyverse: Providing a grammar for&hellip;  Graphics (ggplot) Data manipulations (dplyr) Tidying data (tidyr) Ever expanding specialized topics (not quite modeling yet, although there is some)  Reading in data rio makes it easy  Remember there are a bunch of different options you can specify" />
<meta property="og:type" content="article" />
<meta property="og:url" content="/vita/classr/slides/w6p2/w6p2/" />
















<meta itemprop="name" content="Review">
<meta itemprop="description" content="em { font-style: italic }   strong { font-weight: bold; }  Agenda  Review where we&rsquo;ve been  reading in data dplyr tidyr  Where to next? (briefly) Lab  Work on your final project   Tidyverse: Providing a grammar for&hellip;  Graphics (ggplot) Data manipulations (dplyr) Tidying data (tidyr) Ever expanding specialized topics (not quite modeling yet, although there is some)  Reading in data rio makes it easy  Remember there are a bunch of different options you can specify">



<meta itemprop="wordCount" content="2760">



<meta itemprop="keywords" content="" />
<meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="Review"/>
<meta name="twitter:description" content="em { font-style: italic }   strong { font-weight: bold; }  Agenda  Review where we&rsquo;ve been  reading in data dplyr tidyr  Where to next? (briefly) Lab  Work on your final project   Tidyverse: Providing a grammar for&hellip;  Graphics (ggplot) Data manipulations (dplyr) Tidying data (tidyr) Ever expanding specialized topics (not quite modeling yet, although there is some)  Reading in data rio makes it easy  Remember there are a bunch of different options you can specify"/>

<!--[if lte IE 9]>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/classlist/1.1.20170427/classList.min.js"></script>
<![endif]-->

<!--[if lt IE 9]>
  <script src="https://cdn.jsdelivr.net/npm/html5shiv@3.7.3/dist/html5shiv.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/respond.js@1.4.2/dest/respond.min.js"></script>
<![endif]-->

</head>
<body>
  <div id="mobile-navbar" class="mobile-navbar">
  <div class="mobile-header-logo">
    <a href="/" class="logo">Data Science in Education</a>
  </div>
  <div class="mobile-navbar-icon">
    <span></span>
    <span></span>
    <span></span>
  </div>
</div>
<nav id="mobile-menu" class="mobile-menu slideout-menu">
  <ul class="mobile-menu-list">
    <a href="/post/">
        <li class="mobile-menu-item">Archives</li>
      </a><a href="/tags/">
        <li class="mobile-menu-item">Tags</li>
      </a><a href="/categories/">
        <li class="mobile-menu-item">Categories</li>
      </a><a href="/about/">
        <li class="mobile-menu-item">About</li>
      </a><a href="/talks/vita/">
        <li class="mobile-menu-item">Talks</li>
      </a><a href="/vita/vita/">
        <li class="mobile-menu-item">Vita</li>
      </a>
  </ul>
</nav>
  <div class="container" id="mobile-panel">
    <header id="header" class="header">
        <div class="logo-wrapper">
  <a href="/" class="logo">Data Science in Education</a>
</div>

<nav class="site-navbar">
  <ul id="menu" class="menu">
    <li class="menu-item">
        <a class="menu-item-link" href="/post/">Archives</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="/tags/">Tags</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="/categories/">Categories</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="/about/">About</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="/talks/vita/">Talks</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="/vita/vita/">Vita</a>
      </li>
  </ul>
</nav>

    </header>

    <main id="main" class="main">
      <div class="content-wrapper">
        <div id="content" class="content">
          <article class="post">
  <div class="post-content">
      

<style>
em {
  font-style: italic
}
</style>

<style>
strong {
  font-weight: bold;
}
</style>

<h2 id="agenda">Agenda</h2>

<ul>
<li>Review where we&rsquo;ve been

<ul>
<li>reading in data</li>
<li>dplyr</li>
<li>tidyr</li>
</ul></li>
<li>Where to next? (briefly)</li>
<li>Lab

<ul>
<li>Work on your final project</li>
</ul></li>
</ul>

<hr />

<h2 id="tidyverse-providing-a-grammar-for">Tidyverse: Providing a grammar for&hellip;</h2>

<ul>
<li>Graphics (ggplot)</li>
<li>Data manipulations (dplyr)</li>
<li>Tidying data (tidyr)</li>
<li>Ever expanding specialized topics (not quite modeling yet, although there is some)</li>
</ul>

<hr />

<h1 id="reading-in-data">Reading in data</h1>

<hr />

<h2 id="rio-makes-it-easy"><em>rio</em> makes it easy</h2>

<ul>
<li><p>Remember there are a bunch of different options you can specify</p>

<ul>
<li>Different delimiters</li>
<li><code>setclass</code> argument</li>
<li><code>header</code></li>
</ul></li>

<li><p>Occassionally, using the specific package directly might be easier (though rarely)</p></li>
</ul>

<hr />

<h2 id="labels">Labels</h2>

<ul>
<li>haven, used under the hood by rio, tries to maintain the attributes a variable had when it was in SPSS, SAS, or STATA.</li>
<li>To do this, it provides a new <em>labelled</em> class</li>
<li>This way, no information is lost, and you can decide what to do with them

<ul>
<li>remove labels</li>
<li>coerce to factor</li>
</ul></li>
<li>If you do nothing with them, rio will treat them as numeric

<ul>
<li>Won&rsquo;t show you, simply, which have the underlying labelled class</li>
</ul></li>
</ul>

<hr />

<h2 id="example-from-homework-5">Example from Homework 5</h2>

<pre><code class="language-r">library(rio)
library(dplyr)
gss &lt;- import(&quot;../../data/GSS2014merged_R6.sav&quot;, setclass = &quot;tbl_df&quot;)
gss &lt;- gss %&gt;% 
  select(year, id, age, educ, sex, race, res16, income, partyid, polviews,
    VOTE08, VOTE12, PRES08, PRES12)
head(gss)
</code></pre>

<pre><code>## # A tibble: 6 x 14
##    year    id   age  educ   sex  race res16 income partyid polviews VOTE08
##   &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;  &lt;dbl&gt;   &lt;dbl&gt;    &lt;dbl&gt;  &lt;dbl&gt;
## 1  2014     1    53    16     1     1     5     12       5        6      2
## 2  2014     2    26    16     2     1     3     12       5        5      1
## 3  2014     3    59    13     1     1     3     12       6        5      1
## 4  2014     4    56    16     2     1     3     12       5        4      1
## 5  2014     5    74    17     2     1     6     NA       3        4      1
## 6  2014     6    56    17     2     1     3     12       6        5      1
## # ... with 3 more variables: VOTE12 &lt;dbl&gt;, PRES08 &lt;dbl&gt;, PRES12 &lt;dbl&gt;
</code></pre>

<hr />

<pre><code class="language-r">gss &lt;- gss %&gt;% 
  mutate(age = as.numeric(age),
         educ = as.numeric(educ)) %&gt;% 
  factorize()
gss
</code></pre>

<pre><code>## # A tibble: 3,842 x 14
##     year    id   age  educ    sex   race           res16         income
##    &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;fctr&gt; &lt;fctr&gt;          &lt;fctr&gt;         &lt;fctr&gt;
##  1  2014     1    53    16   MALE  WHITE BIG-CITY SUBURB $25000 OR MORE
##  2  2014     2    26    16 FEMALE  WHITE   TOWN LT 50000 $25000 OR MORE
##  3  2014     3    59    13   MALE  WHITE   TOWN LT 50000 $25000 OR MORE
##  4  2014     4    56    16 FEMALE  WHITE   TOWN LT 50000 $25000 OR MORE
##  5  2014     5    74    17 FEMALE  WHITE  CITY GT 250000           &lt;NA&gt;
##  6  2014     6    56    17 FEMALE  WHITE   TOWN LT 50000 $25000 OR MORE
##  7  2014     7    63    12   MALE  WHITE  CITY GT 250000           &lt;NA&gt;
##  8  2014     8    34    17   MALE  WHITE BIG-CITY SUBURB $25000 OR MORE
##  9  2014     9    37    10 FEMALE  WHITE   TOWN LT 50000 $15000 - 19999
## 10  2014    10    30    15 FEMALE  OTHER  CITY GT 250000 $25000 OR MORE
## # ... with 3,832 more rows, and 6 more variables: partyid &lt;fctr&gt;,
## #   polviews &lt;fctr&gt;, VOTE08 &lt;fctr&gt;, VOTE12 &lt;fctr&gt;, PRES08 &lt;fctr&gt;,
## #   PRES12 &lt;fctr&gt;
</code></pre>

<hr />

<h2 id="last-note">Last note</h2>

<ul>
<li>It&rsquo;s worth reading the help documentation.</li>
<li>Lots of additional useful arguments.</li>
</ul>

<p><br>
Reading in the data correctly is one of the trickier parts of Homework 6.</p>

<hr />

<h1 id="dplyr">dplyr</h1>

<hr />

<h2 id="dplyr-a-grammar-for-data-wrangling">dplyr: A grammar for data wrangling</h2>

<ul>
<li><code>select()</code>: A subset of columns</li>
<li><code>filter()</code>: A subset of rows</li>
<li><code>mutate()</code>: Add or modify existing columns</li>
<li><code>arrange()</code>: Rows in a ascending or descending order</li>
<li><code>summarize()</code>: A variable according to other functions (e.g., <code>mean()</code>, <code>sd()</code>). Often used in conjunction with <code>group_by()</code></li>
<li><code>group_by</code>: Group a data frame according to a specific variable (usually a factor)</li>
</ul>

<div align = "right">
<img src = ./../assets/img/dplyr_hex.png width = 300 height = 300>
</div>

<hr />

<h2 id="arguments">Arguments</h2>

<ul>
<li><em>dplyr</em> always takes a data frame as its first argument.</li>
<li>Subsequent argument tell <em>dplyr</em> what to do with the data frame.</li>
<li>Returns the modified data frame</li>
</ul>

<hr />

<h2 id="select"><code>select()</code></h2>

<div align = "center">
<img src = ./../assets/img/select.png width = 1000 height = 400>
</div>

<p><br></p>

<p><span style="color:gray">(Figure from Baumer, Kaplan, &amp; Horton, 2017)</span></p>

<hr />

<h2 id="filter"><code>filter()</code></h2>

<div align = "center">
<img src = ./../assets/img/filter.png width = 1000 height = 400>
</div>

<p><br></p>

<p><span style="color:gray">(Figure from Baumer, Kaplan, &amp; Horton, 2017)</span></p>

<hr />

<h2 id="select-helper-funs"><code>select()</code> helper funs</h2>

<ul>
<li><code>starts_with()</code></li>
<li><code>ends_with()</code></li>
<li><code>contains()</code></li>
<li><code>matches()</code></li>
<li><code>num_range()</code></li>
</ul>

<p><strong>Note:</strong> These can be used in other functions as well (e.g., <code>gather</code>), but are probably most often used within <code>select()</code></p>

<hr />

<h2 id="mix-types">Mix types</h2>

<p>You can mix types and helper funs. You can also use select to rearrange your columns.</p>

<pre><code class="language-r">library(ggplot2)
diamonds %&gt;% 
    select(depth, 6, starts_with(&quot;c&quot;), price)
</code></pre>

<pre><code>## # A tibble: 53,940 x 7
##    depth table carat       cut color clarity price
##    &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;     &lt;ord&gt; &lt;ord&gt;   &lt;ord&gt; &lt;int&gt;
##  1  61.5    55  0.23     Ideal     E     SI2   326
##  2  59.8    61  0.21   Premium     E     SI1   326
##  3  56.9    65  0.23      Good     E     VS1   327
##  4  62.4    58  0.29   Premium     I     VS2   334
##  5  63.3    58  0.31      Good     J     SI2   335
##  6  62.8    57  0.24 Very Good     J    VVS2   336
##  7  62.3    57  0.24 Very Good     I    VVS1   336
##  8  61.9    55  0.26 Very Good     H     SI1   337
##  9  65.1    61  0.22      Fair     E     VS2   337
## 10  59.4    61  0.23 Very Good     H     VS1   338
## # ... with 53,930 more rows
</code></pre>

<hr />

<h2 id="filter-boolean-logic"><code>filter()</code> boolean logic</h2>

<p>Left circle == x, right circle == y</p>

<div align = "center">
<img src = ./../assets/img/filter_boolean.png width = 1000 height = 450>
</div>

<p><span style="color:gray">(Figure from Wickham &amp; Grolemund, 2017)</span></p>

<hr />

<h2 id="create-or-overwrite-variables-mutate">Create or overwrite variables: <code>mutate</code></h2>

<h1 id="calculate-gain-score">Calculate gain score</h1>

<pre><code class="language-r">reads &lt;- import(&quot;../../data/Project_Reads_Scores.csv&quot;, setclass = &quot;tbl_df&quot;) %&gt;% 
  janitor::clean_names()
reads %&gt;% 
  mutate(gain = post_test_score - pre_test_score) %&gt;% 
  select(student_id, 5, 7, gain)
</code></pre>

<pre><code>## # A tibble: 48 x 4
##    student_id pre_test_score post_test_score  gain
##         &lt;chr&gt;          &lt;int&gt;           &lt;int&gt; &lt;int&gt;
##  1   Virden 1             43              92    49
##  2   Virden 2             46             104    58
##  3   Virden 3             39              75    36
##  4   Virden 4             35             115    80
##  5   Virden 5             46              85    39
##  6   Virden 6             35              91    56
##  7   Virden 7             40              96    56
##  8   Virden 8             39              74    35
##  9   Virden 9             40              90    50
## 10  Virden 10             45              86    41
## # ... with 38 more rows
</code></pre>

<hr />

<h2 id="overwrite-a-variable">Overwrite a variable</h2>

<ul>
<li>Standardize</li>
</ul>

<pre><code class="language-r">reads %&gt;% 
  mutate(pre_test_score = scale(pre_test_score),
         post_test_score = scale(post_test_score)) %&gt;% 
  select(student_id, 5, 7)
</code></pre>

<pre><code>## # A tibble: 48 x 3
##    student_id pre_test_score post_test_score
##         &lt;chr&gt;          &lt;dbl&gt;           &lt;dbl&gt;
##  1   Virden 1      0.2241918      -0.4333331
##  2   Virden 2      0.6380844       0.4776153
##  3   Virden 3     -0.3276650      -1.7238434
##  4   Virden 4     -0.8795218       1.3126514
##  5   Virden 5      0.6380844      -0.9647197
##  6   Virden 6     -0.8795218      -0.5092455
##  7   Virden 7     -0.1897008      -0.1296836
##  8   Virden 8     -0.3276650      -1.7997557
##  9   Virden 9     -0.1897008      -0.5851578
## 10  Virden 10      0.5001202      -0.8888073
## # ... with 38 more rows
</code></pre>

<hr />

<h2 id="summarize-a-column-or-columns"><code>summarize</code> a column (or columns)</h2>

<ul>
<li>Average pre/post and gain</li>
</ul>

<pre><code class="language-r">reads %&gt;% 
  mutate(gain = post_test_score - pre_test_score) %&gt;% 
  summarize(av_pre = mean(pre_test_score, na.rm = TRUE),
            av_post = mean(post_test_score, na.rm = TRUE),
            av_gain = mean(gain, na.rm = TRUE))
</code></pre>

<pre><code>## # A tibble: 1 x 3
##   av_pre  av_post  av_gain
##    &lt;dbl&gt;    &lt;dbl&gt;    &lt;dbl&gt;
## 1 41.375 97.70833 56.33333
</code></pre>

<hr />

<h2 id="summaries-by-group">Summaries by group</h2>

<ul>
<li>Use <code>group_by</code> to get the same summaries by a grouping factor.
Mean pre/post and gain by test site</li>
</ul>

<pre><code class="language-r">reads %&gt;% 
  mutate(gain = post_test_score - pre_test_score) %&gt;% 
  group_by(test_site) %&gt;% 
  summarize(av_pre = mean(pre_test_score, na.rm = TRUE),
            av_post = mean(post_test_score, na.rm = TRUE),
            av_gain = mean(gain, na.rm = TRUE))
</code></pre>

<pre><code>## # A tibble: 6 x 4
##      test_site   av_pre   av_post  av_gain
##          &lt;chr&gt;    &lt;dbl&gt;     &lt;dbl&gt;    &lt;dbl&gt;
## 1        JONES 38.80000  97.80000 59.00000
## 2    JONES ALL 39.00000  98.00000 59.00000
## 3       VIRDEN 38.66667  92.46667 53.80000
## 4   VIRDEN ALL 39.00000  92.00000 53.00000
## 5     WESTSIDE 46.60000 102.86667 56.26667
## 6 WESTSIDE ALL 47.00000 103.00000 56.00000
</code></pre>

<hr />

<h2 id="conditional-verbs">Conditional verbs</h2>

<ul>
<li><code>*_if</code>, <code>*_all</code> functions can help with efficiency</li>
</ul>

<pre><code class="language-r">reads %&gt;% 
  select_if(is.numeric) %&gt;% 
  summarize_all(mean, na.rm = TRUE)
</code></pre>

<pre><code>## # A tibble: 1 x 10
##   pre_test_score post_test_score unit_1_score unit_2_score unit_3_score
##            &lt;dbl&gt;           &lt;dbl&gt;        &lt;dbl&gt;        &lt;dbl&gt;        &lt;dbl&gt;
## 1         41.375        97.70833     3.270833     4.270833     5.395833
## # ... with 5 more variables: unit_4_score &lt;dbl&gt;, unit_5_6_score &lt;dbl&gt;,
## #   unit_7_score &lt;dbl&gt;, unit_8_score &lt;dbl&gt;, total_score &lt;dbl&gt;
</code></pre>

<hr />

<ul>
<li><code>*_at</code></li>
</ul>

<pre><code class="language-r">reads %&gt;%
  summarize_at(vars(unit_1_score, unit_3_score, unit_7_score), funs(mean, sd))
</code></pre>

<pre><code>## # A tibble: 1 x 6
##   unit_1_score_mean unit_3_score_mean unit_7_score_mean unit_1_score_sd
##               &lt;dbl&gt;             &lt;dbl&gt;             &lt;dbl&gt;           &lt;dbl&gt;
## 1          3.270833          5.395833            16.375        1.267257
## # ... with 2 more variables: unit_3_score_sd &lt;dbl&gt;, unit_7_score_sd &lt;dbl&gt;
</code></pre>

<hr />

<h1 id="data-visualization">Data visualization</h1>

<hr />

<h2 id="reviewing-ggplot2-syntax">Reviewing ggplot2 syntax</h2>

<ul>
<li><code>aes()</code> accesses the variables in your dataset.</li>
<li>Set aesthetics globally outside of <code>aes()</code></li>
<li>Aesthetics set in first call to <code>ggplot</code> will bleed through to subsequent layers.</li>
<li>Change aesthetics within a specific layer by providing arguments within that specific function.</li>
<li>Can even change x/y axes, which can be helpful if you want it defined as categorical for one layer and continuous for a second. Or if you want to plot summary data over the top of the raw data (or vice versa).</li>
</ul>

<hr />

<h2 id="pop-quiz-1">Pop Quiz 1</h2>

<p>What&rsquo;s different about these plots</p>

<p><img src="../assets/fig/ggplot_color-1.png" alt="plot of chunk ggplot_color" /></p>

<p><img src="../assets/fig/ggplot_group-1.png" alt="plot of chunk ggplot_group" /></p>

<hr />

<h2 id="pop-quiz-2">Pop Quiz 2</h2>

<p>What went wrong here?</p>

<p><img src="../assets/fig/change_color-1.png" alt="plot of chunk change_color" /></p>

<hr />

<h2 id="thinking-about-scales-some">Thinking about scales some</h2>

<p>I know&hellip; suppposed to be all review, BUT:
* Same plot, different scales. Which can you see the relation better?</p>

<pre><code class="language-r">ggplot(gapminder, aes(year, gdpPercap, group = country)) +
  geom_line(alpha = 0.3)
</code></pre>

<p><img src="../assets/fig/raw_y-1.png" alt="plot of chunk raw_y" /></p>

<pre><code class="language-r">ggplot(gapminder, aes(year, gdpPercap, group = country)) +
  geom_line(alpha = 0.3) +
  scale_y_log10(label = scales::dollar)
</code></pre>

<p><img src="../assets/fig/log_10_y-1.png" alt="plot of chunk log_10_y" /></p>

<hr />

<h2 id="pop-quiz-3">Pop Quiz 3</h2>

<p>Can you reproduce this plot? (you&rsquo;ll need the gapminder package/data)
<img src="../assets/fig/gpd_faceted1-1.png" alt="plot of chunk gpd_faceted1" /></p>

<hr />

<h2 id="what-about-this-one">What about this one?</h2>

<p><img src="../assets/fig/gpd_faceted2-1.png" alt="plot of chunk gpd_faceted2" /></p>

<hr />

<h2 id="can-you-combine-them">Can you combine them?</h2>

<p><img src="../assets/fig/gpd_faceted3-1.png" alt="plot of chunk gpd_faceted3" /></p>

<hr />

<h1 id="tidy-data-and-tidyr">tidy data and <em>tidyr</em></h1>

<hr />

<h2 id="review-homework-4">Review Homework 4</h2>

<ul>
<li>Tidy the reads dataset, minus columns 5-9</li>
</ul>

<pre><code class="language-r">reads %&gt;% 
  select(-5:-9)
</code></pre>

<pre><code>## # A tibble: 48 x 20
##                 test_year test_type test_site student_id unit_1_score
##                     &lt;chr&gt;     &lt;chr&gt;     &lt;chr&gt;      &lt;chr&gt;        &lt;int&gt;
##  1 06/01/2016 12:00:00 AM  YEAR END    VIRDEN   Virden 1            3
##  2 06/01/2016 12:00:00 AM  YEAR END    VIRDEN   Virden 2            5
##  3 06/01/2016 12:00:00 AM  YEAR END    VIRDEN   Virden 3            4
##  4 06/01/2016 12:00:00 AM  YEAR END    VIRDEN   Virden 4            4
##  5 06/01/2016 12:00:00 AM  YEAR END    VIRDEN   Virden 5            2
##  6 06/01/2016 12:00:00 AM  YEAR END    VIRDEN   Virden 6            5
##  7 06/01/2016 12:00:00 AM  YEAR END    VIRDEN   Virden 7            5
##  8 06/01/2016 12:00:00 AM  YEAR END    VIRDEN   Virden 8            4
##  9 06/01/2016 12:00:00 AM  YEAR END    VIRDEN   Virden 9            6
## 10 06/01/2016 12:00:00 AM  YEAR END    VIRDEN  Virden 10            4
## # ... with 38 more rows, and 15 more variables: unit_1_percent &lt;chr&gt;,
## #   unit_2_score &lt;int&gt;, unit_2_percent &lt;chr&gt;, unit_3_score &lt;int&gt;,
## #   unit_3_percent &lt;chr&gt;, unit_4_score &lt;int&gt;, unit_4_percent &lt;chr&gt;,
## #   unit_5_6_score &lt;int&gt;, unit_5_6_percent &lt;chr&gt;, unit_7_score &lt;int&gt;,
## #   unit_7_percent &lt;chr&gt;, unit_8_score &lt;int&gt;, unit_8_percent &lt;chr&gt;,
## #   total_score &lt;int&gt;, total_percent_correct &lt;chr&gt;
</code></pre>

<hr />

<h2 id="common-mistakes">Common mistakes</h2>

<ul>
<li>Forget to filter out summary rows</li>
<li>Multiple gathers</li>
</ul>

<hr />

<h2 id="common-thought-process">Common thought process</h2>

<ul>
<li><code>gather</code> once for raw scores, and a second time for percentages.</li>
<li>Anything wrong with this?</li>
</ul>

<pre><code class="language-r">library(tidyr)
double_gather &lt;- reads %&gt;% 
  select(4, 1:3, 10:23) %&gt;% 
  filter(student_id != &quot;All Students (Average)&quot;) %&gt;% 
  gather(unit, score, contains(&quot;score&quot;)) %&gt;% 
  gather(unit2, percent, contains(&quot;percent&quot;)) %&gt;% 
  mutate(unit = readr::parse_number(unit)) %&gt;% 
  select(-unit2)
</code></pre>

<hr />

<pre><code class="language-r">double_gather
</code></pre>

<pre><code>## # A tibble: 2,205 x 7
##    student_id              test_year test_type test_site  unit score
##         &lt;chr&gt;                  &lt;chr&gt;     &lt;chr&gt;     &lt;chr&gt; &lt;dbl&gt; &lt;int&gt;
##  1   Virden 1 06/01/2016 12:00:00 AM  YEAR END    VIRDEN     1     3
##  2   Virden 2 06/01/2016 12:00:00 AM  YEAR END    VIRDEN     1     5
##  3   Virden 3 06/01/2016 12:00:00 AM  YEAR END    VIRDEN     1     4
##  4   Virden 4 06/01/2016 12:00:00 AM  YEAR END    VIRDEN     1     4
##  5   Virden 5 06/01/2016 12:00:00 AM  YEAR END    VIRDEN     1     2
##  6   Virden 6 06/01/2016 12:00:00 AM  YEAR END    VIRDEN     1     5
##  7   Virden 7 06/01/2016 12:00:00 AM  YEAR END    VIRDEN     1     5
##  8   Virden 8 06/01/2016 12:00:00 AM  YEAR END    VIRDEN     1     4
##  9   Virden 9 06/01/2016 12:00:00 AM  YEAR END    VIRDEN     1     6
## 10  Virden 10 06/01/2016 12:00:00 AM  YEAR END    VIRDEN     1     4
## # ... with 2,195 more rows, and 1 more variables: percent &lt;chr&gt;
</code></pre>

<hr />

<h1 id="what-s-going-on">What&rsquo;s going on?</h1>

<pre><code class="language-r">double_gather %&gt;% 
  count(student_id) 
</code></pre>

<pre><code>## # A tibble: 45 x 2
##    student_id     n
##         &lt;chr&gt; &lt;int&gt;
##  1    Jones 1    49
##  2   Jones 10    49
##  3   Jones 11    49
##  4   Jones 12    49
##  5   Jones 13    49
##  6   Jones 14    49
##  7   Jones 15    49
##  8    Jones 2    49
##  9    Jones 3    49
## 10    Jones 4    49
## # ... with 35 more rows
</code></pre>

<hr />

<h2 id="n-rows-by-n-gathers">n rows by n gathers</h2>

<ul>
<li>Assuming 7 columns are gathered each time:</li>
</ul>

<pre><code class="language-r">expo &lt;- tibble(gathers = 1:5, nrows = 7^(1:5))
ggplot(expo, aes(gathers, nrows)) + geom_line()
</code></pre>

<p><img src="../assets/fig/gather_exponential-1.png" alt="plot of chunk gather_exponential" /></p>

<hr />

<h2 id="alternative">Alternative</h2>

<ul>
<li>Gather all, then spread. <strong>BUT</strong>, requires common names to parse out the variables that are currently stored in the column names.</li>
</ul>

<pre><code class="language-r">names(reads)[grep(&quot;\\d_\\d&quot;, names(reads))] &lt;- c(&quot;unit_5-6_score&quot;, &quot;unit_5-6_percent&quot;)
</code></pre>

<pre><code class="language-r">reads_tidy &lt;- reads %&gt;% 
  select(4, 1:3, 10:23) %&gt;% 
  filter(student_id != &quot;All Students (Average)&quot;) %&gt;% 
  gather(var, val, -1:-4) %&gt;% 
  separate(var, c(&quot;dis&quot;, &quot;unit&quot;, &quot;type&quot;), sep = &quot;_&quot;) %&gt;% 
  select(-dis) %&gt;% 
  spread(type, val)
reads_tidy
</code></pre>

<pre><code>## # A tibble: 315 x 7
##    student_id              test_year test_type test_site  unit percent
##  *      &lt;chr&gt;                  &lt;chr&gt;     &lt;chr&gt;     &lt;chr&gt; &lt;chr&gt;   &lt;chr&gt;
##  1    Jones 1 06/01/2016 12:00:00 AM  YEAR END     JONES     1     16%
##  2    Jones 1 06/01/2016 12:00:00 AM  YEAR END     JONES     2     16%
##  3    Jones 1 06/01/2016 12:00:00 AM  YEAR END     JONES     3     20%
##  4    Jones 1 06/01/2016 12:00:00 AM  YEAR END     JONES     4     33%
##  5    Jones 1 06/01/2016 12:00:00 AM  YEAR END     JONES   5-6     30%
##  6    Jones 1 06/01/2016 12:00:00 AM  YEAR END     JONES     7     63%
##  7    Jones 1 06/01/2016 12:00:00 AM  YEAR END     JONES     8     53%
##  8   Jones 10 06/01/2016 12:00:00 AM  YEAR END     JONES     1     12%
##  9   Jones 10 06/01/2016 12:00:00 AM  YEAR END     JONES     2     12%
## 10   Jones 10 06/01/2016 12:00:00 AM  YEAR END     JONES     3     20%
## # ... with 305 more rows, and 1 more variables: score &lt;chr&gt;
</code></pre>

<hr />

<h2 id="where-to-next">Where to next?</h2>

<ul>
<li>Joins (next week)</li>
<li>strings (Week 8)</li>
<li>Factors &amp; Dates (Week 9)

<ul>
<li>Project presentations</li>
</ul></li>
<li>Advanced applications - things we didn&rsquo;t cover in the course (Week 10)

<ul>
<li>Project presentations</li>
</ul></li>
</ul>

<p><strong>The above means the first project presentations will be made 3 weeks from today!</strong>
* Presentation time slots will be randomly assigned. You&rsquo;ll have access to the code that was used to produce the random assignment.</p>

<hr />

<h2 id="quick-challenge-15-minutes-then-final-projects">Quick challenge (15 minutes), then final projects</h2>

<ul>
<li>The following plot comes from <a href="https://datausa.io/profile/geo/oregon/#economy">datausa</a> for Oregon residents.</li>
<li>The data are stored in a file called <em>insurance_coverage.csv</em>

<ul>
<li>Load the data into R and reproduce the plot as best you can</li>
</ul></li>
</ul>

<p><img src="./../assets/img/insurance_plot.png" alt="insurance_plot" /></p>

<hr />

<h2 id="my-method">My method</h2>

<ul>
<li>Load the data</li>
</ul>

<pre><code class="language-r">insurance &lt;- import(&quot;../../data/insurance_coverage.csv&quot;, skip =  3, setclass = &quot;tbl_df&quot;) %&gt;% 
  janitor::clean_names()
</code></pre>

<pre><code>## Warning in fread(skip = 3, input = structure(&quot;../../data/
## insurance_coverage.csv&quot;, class = c(&quot;rio_csv&quot;, : Stopped reading at empty
## line 41 but text exists afterwards (discarded): PK
</code></pre>

<pre><code class="language-r">insurance
</code></pre>

<pre><code>## # A tibble: 36 x 11
##    in_oregon_csvage_bucket      insurance_name     insurance  year
##                      &lt;chr&gt;               &lt;chr&gt;         &lt;chr&gt; &lt;int&gt;
##  1        insurance_18to24 healthcare coverage has_insurance  2014
##  2        insurance_18to24 healthcare coverage has_insurance  2014
##  3        insurance_25to34 healthcare coverage has_insurance  2014
##  4        insurance_25to34 healthcare coverage has_insurance  2014
##  5        insurance_35to44 healthcare coverage has_insurance  2014
##  6        insurance_35to44 healthcare coverage has_insurance  2014
##  7        insurance_45to54 healthcare coverage has_insurance  2014
##  8        insurance_45to54 healthcare coverage has_insurance  2014
##  9        insurance_55to64 healthcare coverage has_insurance  2014
## 10        insurance_55to64 healthcare coverage has_insurance  2014
## # ... with 26 more rows, and 7 more variables: geo_name &lt;chr&gt;, geo &lt;chr&gt;,
## #   sex_name &lt;chr&gt;, sex &lt;chr&gt;, hc_pop &lt;int&gt;, hc_pop_moe &lt;dbl&gt;,
## #   hc_pop_rca &lt;dbl&gt;
</code></pre>

<hr />

<h2 id="compute-percentages">Compute percentages</h2>

<pre><code class="language-r">smry &lt;- insurance %&gt;% 
  group_by(in_oregon_csvage_bucket, sex_name) %&gt;% 
  summarize(by_sex = sum(hc_pop)) %&gt;% 
  ungroup() %&gt;% 
  mutate(percentage = by_sex /sum(by_sex))

smry
</code></pre>

<pre><code>## # A tibble: 18 x 4
##    in_oregon_csvage_bucket sex_name by_sex percentage
##                      &lt;chr&gt;    &lt;chr&gt;  &lt;int&gt;      &lt;dbl&gt;
##  1        insurance_18to24   Female 315069 0.04340083
##  2        insurance_18to24     Male 308047 0.04243355
##  3        insurance_25to34   Female 471116 0.06489635
##  4        insurance_25to34     Male 428039 0.05896248
##  5        insurance_35to44   Female 462859 0.06375894
##  6        insurance_35to44     Male 447112 0.06158979
##  7        insurance_45to54   Female 463471 0.06384325
##  8        insurance_45to54     Male 446924 0.06156389
##  9        insurance_55to64   Female 523872 0.07216350
## 10        insurance_55to64     Male 476654 0.06565921
## 11        insurance_65to74   Female 398558 0.05490146
## 12        insurance_65to74     Male 363970 0.05013696
## 13         insurance_6to17   Female 544234 0.07496837
## 14         insurance_6to17     Male 573822 0.07904412
## 15        insurance_75plus   Female 292121 0.04023974
## 16        insurance_75plus     Male 215312 0.02965928
## 17       insurance_under_6   Female 260425 0.03587361
## 18       insurance_under_6     Male 267910 0.03690467
</code></pre>

<hr />

<h2 id="reorder-and-relevel-age-ranges">Reorder and relevel age ranges</h2>

<ul>
<li>This was really tricky - we haven&rsquo;t really talked about this yet</li>
</ul>

<pre><code class="language-r">smry$in_oregon_csvage_bucket &lt;- gsub(&quot;insurance_&quot;, &quot;&quot;, smry$in_oregon_csvage_bucket)
smry &lt;- smry %&gt;% 
  mutate(age_range = factor(in_oregon_csvage_bucket,
                            levels = c(&quot;under_6&quot;, &quot;6to17&quot;, &quot;18to24&quot;, &quot;25to34&quot;, 
                                       &quot;35to44&quot;, &quot;45to54&quot;, &quot;55to64&quot;, &quot;65to74&quot;,
                                       &quot;75plus&quot;),
                            labels = c(&quot;&lt; 6&quot;, &quot;6-17&quot;, &quot;18-24&quot;, &quot;25-34&quot;, &quot;35-44&quot;,
                                       &quot;45-54&quot;, &quot;55-64&quot;, &quot;65-74&quot;, &quot;75 +&quot;)))
</code></pre>

<hr />

<h2 id="produce-the-plot">Produce the plot</h2>

<pre><code class="language-r">ggplot(smry, aes(age_range, percentage, fill = sex_name)) +
  geom_bar(stat = &quot;identity&quot;,  alpha = 0.9) +
  scale_fill_manual(values = c(&quot;firebrick3&quot;, &quot;#323560&quot;)) +
  scale_y_continuous(name = &quot;SHARE&quot;, 
                     breaks = seq(0, 0.14, 0.02),
                     labels = scales::percent) +
  xlab(&quot;&quot;) +
  ggthemes::theme_hc()
</code></pre>

<p><img src="../assets/fig/reproduce_plot-1.png" alt="plot of chunk reproduce_plot" /></p>

<hr />

<h2 id="make-it-interactive">Make it interactive</h2>

<pre><code class="language-r">library(plotly)
p &lt;- ggplot(smry, aes(age_range, percentage, fill = sex_name)) +
  geom_bar(stat = &quot;identity&quot;,  alpha = 0.9) +
  scale_fill_manual(values = c(&quot;firebrick3&quot;, &quot;#323560&quot;)) +
  scale_y_continuous(name = &quot;SHARE&quot;, 
                     breaks = seq(0, 0.14, 0.02),
                     labels = scales::percent) +
  xlab(&quot;&quot;) +
  ggthemes::theme_hc()

ggplotly(p)
</code></pre>

<hr />

<h1 id="final-project-time">Final Project Time</h1>

  </div>
</article>
        </div>
        
  <div id="disqus_thread"></div>
    <script type="text/javascript">
    (function() {
      
      
      if (window.location.hostname === 'localhost') return;

      var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
      var disqus_shortname = 'http-www-dandersondata-com';
      dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
      (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();
    </script>
    <noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>

  

  
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="social-links">
      <a href="mailto:daniela@uoregon.edu" class="iconfont icon-email" title="email"></a>
      <a href="https://stackoverflow.com/users/4959854/daniel-anderson" class="iconfont icon-stack-overflow" title="stack-overflow"></a>
      <a href="https://twitter.com/DJAnderson_07" class="iconfont icon-twitter" title="twitter"></a>
      <a href="https://github.com/DJAnderson07" class="iconfont icon-github" title="github"></a>
  <a href="/index.xml" type="application/rss+xml" class="iconfont icon-rss" title="rss"></a>
</div>

<div class="copyright">
  <span class="power-by">
    Powered by <a class="hexo-link" href="https://gohugo.io">Hugo</a>
  </span>
  <span class="division">|</span>
  <span class="theme-info">
    Theme - 
    <a class="theme-link" href="https://github.com/olOwOlo/hugo-theme-even">Even</a>
  </span>

  

  <span class="copyright-year">
    &copy; 
    
      2017 - 
    2018
    <span class="author">Daniel Anderson</span>
  </span>
</div>
    </footer>

    <div class="back-to-top" id="back-to-top">
      <i class="iconfont icon-up"></i>
    </div>
  </div>
  
<script src="/lib/highlight/highlight.pack.js"></script>
<script>hljs.initHighlightingOnLoad();</script>

<script type="text/javascript" src="/lib/jquery/jquery-3.2.1.min.js"></script>
  <script type="text/javascript" src="/lib/slideout/slideout-1.0.1.min.js"></script>
  <script type="text/javascript" src="/lib/fancybox/jquery.fancybox-3.1.20.min.js"></script>
<script type="text/javascript" src="/dist/even.min.js?v=3.0.1"></script>
  <script type="text/javascript">
    window.MathJax = {
      tex2jax: {inlineMath: [['$','$'], ['\\(','\\)']]},
      showProcessingMessages: false,
      messageStyle: 'none'
    };
  </script>
  <script type="text/javascript" async src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.2/MathJax.js?config=TeX-MML-AM_CHTML"></script>








</body>
</html>
